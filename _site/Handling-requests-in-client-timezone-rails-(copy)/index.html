<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>TimeZone - Handling requests in client's time zone in a rails app &#8211; Tech stream</title>
<meta name="description" content="Handling requests in the client's time zone in a rails app, based on the request.">
<meta name="keywords" content="javascript, programming, ror, ruby, web">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="TimeZone - Handling requests in client's time zone in a rails app">
<meta property="og:description" content="Handling requests in the client's time zone in a rails app, based on the request.">
<meta property="og:url" content="http://localhost:4000/Handling-requests-in-client-timezone-rails-(copy)/">
<meta property="og:site_name" content="Tech stream">





<link rel="canonical" href="http://localhost:4000/Handling-requests-in-client-timezone-rails-(copy)/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Tech stream Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<!-- Webfonts -->
<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">


</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://localhost:4000/index.html">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li class="author-info">
					<img src="http://localhost:4000/images/uday.jpg" alt="Udaya Kiran photo" class="author-photo">
					<h4>Udaya Kiran</h4>
				</li>
				<li>
					<p>Engineering & Product Leader, Programmer, Entrepreneur</p>
				</li>
				<li>
					<a href="mailto:udaykiran.vit@gmail.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				
				
				
				<li>
					<a href="http://linkedin.com/in/udaykirank"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="http://github.com/udayakiran"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		
	    
	    <li><a href="http://localhost:4000/posts/" >All Posts</a></li>
	  
	    
	    <li><a href="http://localhost:4000/tags/" >All Tags</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div class="entry-header">
  <div class="entry-image">
  <!--<div class="entry-image" style="background-color: #616161db"> -->
    <!--<img src="http://localhost:4000/images/abstract-6.jpg" alt="TimeZone - Handling requests in client's time zone in a rails app">-->
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://localhost:4000/Handling-requests-in-client-timezone-rails-(copy)/" rel="bookmark" title="TimeZone - Handling requests in client's time zone in a rails app">TimeZone - Handling requests in client's time zone in a rails app</a></h1>
        
        
        <h2 class="entry-reading-time" style="text-align: center">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~5 minutes
          <i style="font-style:normal;">  |  </i>
          January 04, 2016
        </h2><!-- /.entry-reading-time -->
        
      </span>
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>This post is a continuation of one of my previous posts -</p>

<p><a href="/Handling-requests-in-browser-timezone-rails/">TimeZone - Handling requests in client’s time zone in a rails app</a></p>

<p>It is recommended to visit that post before proceeding furthur on current post.</p>

<div style="text-align: center">
<figure class="full">
	<img src="/images/tz.png" width="600px" alt="" />
</figure>
</div>

<p>This post describes an enhanced solution of rails_browser_timezone gem.</p>

<h2 id="open-issues-with-rails_browser_timezone--">Open issues with rails_browser_timezone -</h2>

<ol>
  <li>
    <p>The very first hit to the server from a browser does not pass the browser offsets, which means this request runs in either the default system timezone or the last known timezone from the DB.</p>
  </li>
  <li>
    <p>This method does not help when the requests are received through APIs. APIs need to either explicitly pass browser off sets with each request or the requests run in the last known timezone which is persisted.</p>
  </li>
  <li>
    <p>Some browsers take time to reflect upon the new timezone when client’s system time zone is changed. So, those few requests made meanwhile do not have the updated timezone.</p>
  </li>
</ol>

<h2 id="alternatives--">Alternatives -</h2>

<p>While looking at some alternatives to the previous approach all i could find was either to go with JS based timezone tracking or tracking the timezone based on the geo-location which can be obtained from the request’s IP address.</p>

<p>JS based timezone tracking is buggy when it comes to handling the time zone names on rails servers, as we know from the previous post. Though this can be fixed by mapping these time zones to rails’s timezone strings, we still have the problem that APIs cant use this method.</p>

<p>Hence, tracking the timezone based on geoip seems to be one good alternative. The only limitation of this approach is that, a user who has his system timezone different than his location’s timezone will still see the information in the location’s timezone.</p>

<p>This is just a decision based on your app and how you want to deal with it. So, wanted to write a gem with supports timezone tracking based on both browsers and geoip and leave the developers with the flexibility of deciding which method they want to use to choose this.</p>

<h2 id="a-comprehensive-solution--">A comprehensive solution -</h2>

<p>Keeping the above discussion up, tried to put together a gem called <code class="language-plaintext highlighter-rouge">rails_client_timezone</code> which intends to solve all the above mentioned problems and gives developers the flexibility to choose how they want to track the time zone.</p>

<p>Source - <a href="https://github.com/udayakiran/rails_client_timezone">https://github.com/udayakiran/rails_client_timezone</a></p>

<p>Please follow the README which helps to get started.</p>

<ul>
  <li>
    <p>This gem reuses the logic from <a href="https://github.com/udayakiran/rails_browser_timezone">rails_browser_timezone gem</a> to track browser based timezones.</p>
  </li>
  <li>
    <p>It can track the timezone based on the ip with the help of <a href="https://rubygems.org/gems/geoip/versions/1.6.1">geoip gem</a>. A few tweaks were needed to this gem and had to put in efforts to map some of these timezone strings to match with the rails’s timezone strings.</p>
  </li>
  <li>
    <p>This gem works smartly to track the timezone from ip if browser offsets are not present and it also lets the programmers set the needed preference. This is a key addition.</p>
  </li>
</ul>

<h3 id="explanation-for-modes--">Explanation for modes -</h3>

<p>This gem supports 3 modes which can optionally be configured by the developers. Default mode is <code class="language-plaintext highlighter-rouge">:smart</code> .  Blow is the explanation for modes.</p>

<p><strong>:ip -</strong> Time zone will be detected based on the request’s ip address(using geoip gem’s logic)</p>

<p><strong>:browser -</strong> Time zone will be detected based on browser utc offsets.</p>

<p><strong>:smart -</strong> Time zone will be detected by browser if offsets are set or it falls back to ip(:browser mode first, which falls back to :ip mode).</p>

<p>Create a file in your initializers and set the ‘mode’ to your choice.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Say in config/initializers/rails_client_tz_init.rb</span>

<span class="no">RailsClientTimezone</span><span class="o">::</span><span class="no">Setting</span><span class="p">.</span><span class="nf">mode</span> <span class="o">=</span> <span class="ss">:ip</span>
<span class="c1">#default value is :smart. Accepted values - :browser, :ip, :smart</span></code></pre></figure>

<h3 id="keeping-the-geoip-data-upto-date--">Keeping the geoip data upto date -</h3>

<p>This is one minor limitation / update i think we will have to deal with while using this gem. This is needed only for <code class="language-plaintext highlighter-rouge">:ip</code> and <code class="language-plaintext highlighter-rouge">:smart</code> modes.</p>

<p>Geoip gem depends on geo data which consists of the information about the ips mapped to the geo locations. This database is consistent and up to date as of now, but in future to improve it’s accuracy and bring in the changes, we can update this any time. There are a number of websites which provide this data.</p>

<p>By default Geoip City db file is available in the data directory, to override that db file you can download it from Download geoip city database and place anywhere in your app. Create a file in your initializers and set the geo ip city db file path. This step is optional if you are good with the data provided by the gem.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Say in config/initializers/rails_client_tz_init.rb</span>

<span class="no">RailsClientTimezone</span><span class="o">::</span><span class="no">Setting</span><span class="p">.</span><span class="nf">geoip_data_path</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">file_path</span><span class="o">&gt;</span>  <span class="c1">#Default path is &lt;gem_source&gt;/data/geoip/GeoLiteCity.dat</span></code></pre></figure>

<blockquote>
  <blockquote>
    <p>Hope that this gem provides needed help for the rails developers in handling the issues with time zones.</p>
  </blockquote>
</blockquote>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://localhost:4000/tags/#javascript" title="Pages tagged javascript" class="tag"><span class="term">javascript</span></a><a href="http://localhost:4000/tags/#programming" title="Pages tagged programming" class="tag"><span class="term">programming</span></a><a href="http://localhost:4000/tags/#ror" title="Pages tagged ror" class="tag"><span class="term">ror</span></a><a href="http://localhost:4000/tags/#ruby" title="Pages tagged ruby" class="tag"><span class="term">ruby</span></a><a href="http://localhost:4000/tags/#web" title="Pages tagged web" class="tag"><span class="term">web</span></a></span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/Handling-requests-in-client-timezone-rails-(copy)/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://localhost:4000/Handling-requests-in-client-timezone-rails-(copy)/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=http://localhost:4000/Handling-requests-in-client-timezone-rails-(copy)/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="http://localhost:4000/2015-11-2-ruby-beyond-rails/" class="btn btn-read-more">Read More</a>
    </div><!-- /.read-more-header -->
    <!-- <div class="read-more-content">
      <h3><a href="http://localhost:4000/Collaborative-Web-Browsing-Present-and-Future/" title="Collaborative Web Browsing - Present and Future">Collaborative Web Browsing - Present and Future</a></h3>
      <p>Collaborative web browsing is at a pitoval moment. Good to see it getting rolled into utilities such as web browsers, mobile operating systems and etc. <a href="http://localhost:4000/Collaborative-Web-Browsing-Present-and-Future/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="http://localhost:4000/SERP-Reimagined-for-better-ad-yields/" title="Desktop Web Search Engine Results Page - Design Considerations for Better Ad Revenues">Desktop Web Search Engine Results Page - Design Considerations for Better Ad Revenues</a></h4>
        <span>Published on March 05, 2020</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="http://localhost:4000/Engineering-Leadership-Excellence-Hiring/" title="Engineering Leadership: Hiring & Onboarding 202 - Hire Right, Hire Fast!">Engineering Leadership: Hiring & Onboarding 202 - Hire Right, Hire Fast!</a></h4>
        <span>Published on January 20, 2020</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->

  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2022 Udaya Kiran </span>
<span style="display:block"><a href="https://www.linkedin.com/in/udaykirank/" target="blank"><img src="http://localhost:4000/images/uday.jpg" style="height: 64px;margin-top: 10px;border-radius:50%;border: 1px solid #FF7A59;"/> </a> </span>
<span style="display:block">Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>

  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>






</body>
</html>
